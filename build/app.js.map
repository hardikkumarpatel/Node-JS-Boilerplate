{"version":3,"file":"app.js","names":["require","_express","_interopRequireDefault","_http","_cors","_path","_helmet","_cookieParser","_helpers","_middleware","_routes","_config2","_swagger","_mongodb","_sql","e","__esModule","default","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ExpressEngine","constructor","app","express","PORT","Config","get","IConfig","run","_this","AppHelper","validate","process","exit","startApp","signalListening","catch","Log","error","_this2","server","http","createServer","set","on","serverErrorListening","info","serverListening","initialize","listen","_this3","initializeMiddleware","initializeRoutes","initializeSwaggerDocs","initializeSocketApp","initializeGlobalMiddleware","_this4","use","urlencoded","extended","json","limit","MorganLogMiddleware","success","static","path","cors","origin","methods","helmet","contentSecurityPolicy","cookies","_this5","ApiCommonHelper","useHealthHelper","routes","_this6","SwaggerApp","_this7","SocketAppHelper","_this8","useNotFoundHelper","ApiErrorMiddleware","_default","exports"],"sources":["../src/app.js"],"sourcesContent":["import \"dotenv/config\";\nimport express from \"express\";\nimport http from \"http\";\nimport cors from \"cors\";\nimport path from \"path\";\nimport helmet from \"helmet\";\nimport cookies from \"cookie-parser\";\nimport { ApiCommonHelper, AppHelper, Log, SocketAppHelper } from \"@/helpers\";\nimport { ApiErrorMiddleware, MorganLogMiddleware } from \"@/middleware\";\nimport routes from \"@/routes\";\nimport { Config, IConfig } from \"@/config\";\nimport { SwaggerApp } from \"@/swagger\";\nimport { MongoDBConnection } from \"@/database/mongodb\";\nimport { SequelizeDBConnection } from \"@/database/sql\";\nclass ExpressEngine {\n  constructor() {\n    this.app = express();\n    this.PORT = Config.get(IConfig.PORT);\n  }\n\n  async run() {\n    if (!(await AppHelper.validate())) process.exit(1);\n    await this.startApp().then(AppHelper.signalListening).catch(Log.error);\n  }\n\n  async startApp() {\n    this.server = http.createServer(this.app);\n    this.app.set(\"port\", this.PORT);\n    this.server.on(\"error\", AppHelper.serverErrorListening);\n    this.server.on(\"close\", Log.info);\n    this.server.on(\"listening\", async () => {\n      await AppHelper.serverListening(this.server).then(this.initialize());\n    });\n    this.server.listen(this.PORT);\n    return this.server;\n  }\n\n  async initialize() {\n    // await MongoDBConnection.connect();\n    // await SequelizeDBConnection.connect();\n    await this.initializeMiddleware();\n    await this.initializeRoutes();\n    await this.initializeSwaggerDocs();\n    await this.initializeSocketApp();\n    await this.initializeGlobalMiddleware();\n  }\n\n  async initializeMiddleware() {\n    this.app.use(express.urlencoded({ extended: true }));\n    this.app.use(express.json({ limit: \"6kb\" }));\n    this.app.use(new MorganLogMiddleware().success);\n    this.app.use(new MorganLogMiddleware().error);\n    this.app.use(\"/upload\", express.static(path.resolve(\"src\", \"upload\")));\n    this.app.use(\n      cors({\n        origin: \"*\",\n        methods: [\"GET\", \"HEAD\", \"PUT\", \"OPTIONS\", \"PATCH\", \"POST\", \"DELETE\"]\n      })\n    );\n    this.app.use(helmet({ contentSecurityPolicy: false }));\n    this.app.use(cookies());\n  }\n\n  async initializeRoutes() {\n    this.app.use(\"/health\", ApiCommonHelper.useHealthHelper);\n    this.app.use(routes);\n  }\n\n  async initializeSwaggerDocs() {\n    await new SwaggerApp(this.app).initialize().then(Log.info).catch(Log.error);\n  }\n\n  async initializeSocketApp() {\n    await new SocketAppHelper(this.server).initialize().then(Log.info).catch(Log.error);\n  }\n\n  async initializeGlobalMiddleware() {\n    this.app.use(\"*\", ApiCommonHelper.useNotFoundHelper);\n    this.app.use(ApiErrorMiddleware.use);\n  }\n}\n\nexport default ExpressEngine;\n"],"mappings":"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","ignoreList":[]}